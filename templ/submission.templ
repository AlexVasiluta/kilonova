{{ template "util/header" . }}

<div class="container">
	{{ $editor := .SubEditor }}
	{{ $problem := subProblem .Submission }}
	{{ $author := subAuthor .Submission }}
	{{ with .Submission }}
		<h2>Submission {{ .ID }}</h2>
		<p>Autor: {{ $author.Name }}</p>
		<p>Data încărcării: {{ .CreatedAt }}</p>
		<p>Status: {{ subStatus .Status }}</p>
		<p>Limbaj: {{ .Language }}</p>
		<p>Problemă: <a href="/probleme/{{$problem.ID}}">{{ $problem.Name }}</a></p>
		<p>Scor: {{ .Score }} </p>
			
		{{ if and .CompileError.Valid .CompileError.Bool }}
		
		<p>Eroare de compilare?: {{ .CompileError.Bool }}</p>

		<h5>Mesaj Evaluare:</h5>
		<pre>{{- .CompileMessage.String -}}</pre>
		
		{{ end }}

		{{ if not .CompileError.Bool }}
			{{ with (subTests .) }}
				<table class="table">
						<thead class="thead-dark">
						<tr>
							<th scope="col">
								ID
							</th>
							<th scope="col">
								Status
							</th>
							<th scope="col">
								Scor posibil
							</th>
							<th scope="col">
								Scor obținut
							</th>
							<th scope="col">
								Timp
							</th>
							<th scope="col">
								Memorie utilizată
							</th>
						</tr>
					</thead>
					<tbody>
						{{ range . }}
							{{ $test := getTest .TestID }}
							{{ if .Done }}
								<tr style="{{ gradient .Score $test.Score }}">
							{{ else }}
								<tr>
							{{ end }}
							<th scope="col">
									{{- $test.VisibleID -}}
								</th>
								<td>
									{{ if .Done }}
										{{- .Verdict -}}
									{{ else }}
									<div class="spinner-border spinner-border-sm" role="status"></div>
										Waiting...
									{{ end }}
								</td>
								<td>
									{{- $test.Score -}}
								</td>
								<td>
									{{- .Score -}}
								</td>
								<td>
									{{- printf "%.2f" .Time -}}
								</td>
								<td>
									{{- .Memory -}}KB
								</td>
							</tr>
						{{ end }}
					</tbody>
				</table>
			{{ end }}
		{{ end }}

		{{ if not (eq .Code "") }}
			<h3>Codul Sursă:</h3>
			<pre><code class="{{ .Language }}">{{ .Code }} </code></pre>
			
			{{ if $editor }}
				<button id="vButton" class="btn btn-primary mb-2" onclick="toggleVisible()">Fă codul {{ if .Visible}}invizibil{{else}}vizibil{{end}}</button>

				<script>
					let visible = {{ .Visible }};
					let id = {{ .ID }};

					async function toggleVisible() {
						visible = !visible;
						let res = await postCall("/submissions/setVisible", {visible, id});
						createToast({
							status: res.status,
							title: (res.status == "success" ? (visible ? "Made visible" : "Made invisible") : "Error changing visibility"),
							description: res.data
						});

						$("#vButton").html(`Fă codul ${visible ? "invizibil" : "vizibil"}`)
					}
				</script>
			{{ end }}

		{{ end }}
	{{ end }}
</div>

{{ template "util/footer" . }}
